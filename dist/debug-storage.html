<!DOCTYPE html>
<html>
<head>
    <title>Debug Soul Animal Storage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px; padding: 10px; font-size: 16px; }
        #output { margin-top: 20px; padding: 10px; background: #f5f5f5; }
        pre { background: white; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>ğŸ¦Š éˆé­‚å‹•ç‰©è¨˜éŒ„èª¿è©¦å·¥å…·</h1>
    
    <button onclick="checkStorage()">ğŸ“‹ æª¢æŸ¥ localStorage</button>
    <button onclick="clearStorage()">ğŸ—‘ï¸ æ¸…é™¤ localStorage</button>
    <button onclick="addTestRecord()">â• æ·»åŠ æ¸¬è©¦è¨˜éŒ„ (guest)</button>
    <button onclick="transferTest()">ğŸ”„ æ¸¬è©¦è¨˜éŒ„è½‰ç§»</button>
    
    <div id="output"></div>
    
    <script>
        function checkStorage() {
            const records = localStorage.getItem('soul_animal_records');
            const output = document.getElementById('output');
            
            if (records) {
                const parsed = JSON.parse(records);
                output.innerHTML = '<h3>ğŸ“Š ç•¶å‰è¨˜éŒ„:</h3><pre>' + JSON.stringify(parsed, null, 2) + '</pre>';
                
                // çµ±è¨ˆè³‡è¨Š
                let stats = '<h4>ğŸ“ˆ çµ±è¨ˆè³‡è¨Š:</h4>';
                Object.keys(parsed).forEach(user => {
                    stats += `<p>${user}: ${parsed[user].length} æ¢è¨˜éŒ„</p>`;
                });
                output.innerHTML += stats;
            } else {
                output.innerHTML = '<h3>âŒ æ²’æœ‰æ‰¾åˆ°è¨˜éŒ„</h3>';
            }
        }
        
        function clearStorage() {
            localStorage.removeItem('soul_animal_records');
            document.getElementById('output').innerHTML = '<h3>âœ… å·²æ¸…é™¤ localStorage</h3>';
        }
        
        function addTestRecord() {
            const testRecord = {
                guest: [{
                    id: Date.now(),
                    timestamp: new Date().toLocaleString('zh-TW'),
                    animalResult: {
                        finalAnimal: 'Fox',
                        animalName: 'ç‹ç‹¸ (Fox)',
                        awareness: 75,
                        awarenessLabel: 'é«˜',
                        agePrediction: 'Cç´š (26-35æ­²)',
                        genderPrediction: 'female',
                        level: 'ç‰¹å‹™â€¢ä¸­éš',
                        summary: 'è°æ˜å¥½å¥‡ã€åæ‡‰å¿«ï¼Œä½†å®¹æ˜“è¢«é«˜å ±é…¬èª˜æƒ‘ã€‚',
                        analysis: 'ä½ å¤©ç”Ÿå¥½å¥‡ä¸”è¡Œå‹•åŠ›å¼·ï¼Œæ“…é•·æŠ“ä½æ©Ÿæœƒèˆ‡æ–°äº‹ç‰©ã€‚',
                        topFraudRisks: [['9_investment', 3], ['3_ecommerce', 2]]
                    }
                }]
            };
            
            localStorage.setItem('soul_animal_records', JSON.stringify(testRecord));
            document.getElementById('output').innerHTML = '<h3>âœ… å·²æ·»åŠ æ¸¬è©¦è¨˜éŒ„åˆ° guest ç”¨æˆ¶</h3>';
            setTimeout(checkStorage, 500);
        }
        
        function transferTest() {
            const records = localStorage.getItem('soul_animal_records');
            if (!records) {
                document.getElementById('output').innerHTML = '<h3>âŒ æ²’æœ‰è¨˜éŒ„å¯è½‰ç§»</h3>';
                return;
            }
            
            const parsed = JSON.parse(records);
            if (parsed.guest) {
                // æ¨¡æ“¬è½‰ç§» guest è¨˜éŒ„åˆ° white
                parsed.white = parsed.guest;
                delete parsed.guest;
                localStorage.setItem('soul_animal_records', JSON.stringify(parsed));
                document.getElementById('output').innerHTML = '<h3>âœ… å·²å°‡ guest è¨˜éŒ„è½‰ç§»åˆ° white</h3>';
                setTimeout(checkStorage, 500);
            } else {
                document.getElementById('output').innerHTML = '<h3>âŒ æ²’æœ‰ guest è¨˜éŒ„å¯è½‰ç§»</h3>';
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.onload = checkStorage;
    </script>
</body>
</html>