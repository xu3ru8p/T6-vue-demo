# 🦄 靈魂動物分數計算系統詳解

## 📋 目錄
1. [系統概述](#系統概述)
2. [五維度評估系統](#五維度評估系統)
3. [經驗值系統](#經驗值系統)
4. [靈魂覺醒機制](#靈魂覺醒機制)
5. [動物轉換預測算法](#動物轉換預測算法)
6. [心理軸線分析](#心理軸線分析)
7. [檔案位置索引](#檔案位置索引)
8. [潛在問題分析](#潛在問題分析)

---

## 🎯 系統概述

靈魂動物分數計算系統是一個基於KTDI心理學框架的複合評估系統，主要包含以下幾個子系統：

- **五維度評估**: 基於遊戲表現計算的心理特質分數
- **經驗值系統**: 基於參與度和表現的成長機制
- **覺醒機制**: 解鎖高級功能的門檻系統
- **轉換預測**: 基於分數變化預測動物轉換的算法

---

## 🧠 五維度評估系統

### 📊 基礎維度定義
> **檔案位置**: `src/Analyt.vue` - `soulDimensions` computed 函數 (約第2519行)

| 維度 | 英文名稱 | 計算基礎 | 分數範圍 | 影響因子 |
|------|----------|----------|----------|----------|
| 防詐警覺性 | Fraud_Awareness | 遊戲正確率 | 0-100 | 答對題數/總題數 |
| 反應速度 | Response_Speed | 答題時間 | 0-100 | 平均反應時間倒數 |
| 學習適應性 | Learning_Adaptation | 錯誤改善率 | 0-100 | 後期正確率提升 |
| 風險識別能力 | Risk_Identification | 高難度題正確率 | 0-100 | 困難題答對比例 |
| 持續參與度 | Engagement_Level | 參與頻率 | 0-100 | 遊戲次數和時間分布 |

### 🧮 計算公式詳解

#### 1. 防詐警覺性計算
```javascript
// 基礎公式
const correctAnswers = totalCorrect;
const totalQuestions = totalAnswered;
const baseScore = (correctAnswers / totalQuestions) * 100;

// 加成計算
const streakBonus = Math.min(consecutiveCorrect * 2, 20); // 連續答對加成，最高20分
const difficultyBonus = hardQuestionCorrect * 1.5; // 困難題額外加成

// 最終分數
const fraudAwareness = Math.min(baseScore + streakBonus + difficultyBonus, 100);
```

#### 2. 反應速度計算
```javascript
// 時間分析
const averageTime = totalResponseTime / totalQuestions;
const idealTime = 10; // 理想反應時間(秒)
const maxTime = 60; // 最大合理時間(秒)

// 反比例計算
const speedScore = Math.max(0, (maxTime - averageTime) / (maxTime - idealTime) * 100);

// 快速準確加成
const accuracyTimeBonus = fastAndCorrectAnswers * 3;
const finalSpeedScore = Math.min(speedScore + accuracyTimeBonus, 100);
```

#### 3. 學習適應性計算
```javascript
// 時間段分析
const earlyPeriodAccuracy = getAccuracyInPeriod(0, 0.3); // 前30%遊戲
const latePeriodAccuracy = getAccuracyInPeriod(0.7, 1.0); // 後30%遊戲

// 改善率計算
const improvementRate = (latePeriodAccuracy - earlyPeriodAccuracy) / earlyPeriodAccuracy;
const adaptationScore = Math.max(0, 50 + improvementRate * 100);

// 持續學習加成
const consistencyBonus = calculateConsistencyBonus(gameRecords);
const finalAdaptationScore = Math.min(adaptationScore + consistencyBonus, 100);
```

#### 4. 風險識別能力計算
```javascript
// 難度分類
const easyQuestions = questionsWithDifficulty.filter(q => q.difficulty <= 3);
const hardQuestions = questionsWithDifficulty.filter(q => q.difficulty >= 7);

// 難度加權計算
const easyAccuracy = getAccuracy(easyQuestions) * 0.6;
const hardAccuracy = getAccuracy(hardQuestions) * 1.4;

// 綜合風險識別分數
const riskScore = (easyAccuracy + hardAccuracy) / 2;
const expertiseBonus = calculateExpertiseBonus(specializedCorrect);
const finalRiskScore = Math.min(riskScore + expertiseBonus, 100);
```

#### 5. 持續參與度計算
```javascript
// 頻率分析
const daysActive = getUniqueDaysPlayed(gameRecords);
const totalDays = getDaysSinceFirstPlay();
const frequency = (daysActive / totalDays) * 100;

// 會話長度分析
const averageSessionLength = getTotalPlayTime() / getSessionCount();
const sessionLengthScore = Math.min(averageSessionLength / 30 * 100, 100); // 30分鐘為滿分

// 參與度綜合計算
const engagementScore = (frequency * 0.6 + sessionLengthScore * 0.4);
const longevityBonus = calculateLongevityBonus(totalDays);
const finalEngagementScore = Math.min(engagementScore + longevityBonus, 100);
```

### 📈 分數等級對照表

| 分數範圍 | 等級 | 顏色標示 | 動物類型傾向 |
|----------|------|----------|--------------|
| 90-100 | S級 | 金色 | 深潛分析局 |
| 80-89 | A級 | 紫色 | 影襲特攻隊 |
| 70-79 | B級 | 藍色 | 重裝守備隊 |
| 60-69 | C級 | 綠色 | 閃電先鋒 |
| 50-59 | D級 | 黃色 | 待加強 |
| <50 | E級 | 紅色 | 需重點輔導 |

---

## 🎮 經驗值系統

### 💎 經驗值獲得機制
> **檔案位置**: `src/stores/soulAnimalSystem.js` 和 `src/Analyt.vue` - `userStats` computed

#### 基礎經驗值來源

| 行為 | 基礎經驗值 | 加成條件 | 最大加成 | 計算公式 |
|------|------------|----------|----------|----------|
| 完成Quiz測驗 | +100 XP | 首次完成 | +50 XP | `100 + (isFirstTime ? 50 : 0)` |
| 答對困難題 | +15 XP | 連續答對 | +30 XP | `15 + streakBonus * 3` |
| 答對普通題 | +10 XP | 連續答對 | +20 XP | `10 + streakBonus * 2` |
| 答對簡單題 | +5 XP | 連續答對 | +10 XP | `5 + streakBonus * 1` |
| 完成遊戲回合 | +25 XP | 全對 | +50 XP | `25 + (perfectRound ? 50 : 0)` |
| 每日首次登入 | +20 XP | 連續登入 | +100 XP | `20 + dayStreak * 5` |

#### 連續答對加成算法
```javascript
// 連續答對加成計算
function calculateStreakBonus(consecutiveCorrect) {
    if (consecutiveCorrect < 3) return 0;
    
    // 階段式加成
    const stages = [
        { threshold: 3, bonus: 5 },   // 3連對: +5 XP
        { threshold: 5, bonus: 10 },  // 5連對: +10 XP
        { threshold: 10, bonus: 20 }, // 10連對: +20 XP
        { threshold: 15, bonus: 35 }, // 15連對: +35 XP
        { threshold: 20, bonus: 50 }  // 20連對: +50 XP (上限)
    ];
    
    let bonus = 0;
    for (const stage of stages) {
        if (consecutiveCorrect >= stage.threshold) {
            bonus = stage.bonus;
        }
    }
    
    return bonus;
}
```

#### 難度加成係數
```javascript
// 根據題目難度給予不同經驗值倍率
const difficultyMultiplier = {
    1: 0.8,  // 非常簡單
    2: 0.9,  // 簡單
    3: 1.0,  // 普通
    4: 1.1,  // 稍難
    5: 1.3,  // 中等
    6: 1.5,  // 困難
    7: 1.8,  // 很困難
    8: 2.0,  // 極困難
    9: 2.5,  // 專家級
    10: 3.0  // 大師級
};

// 最終經驗值計算
const finalXP = baseXP * difficultyMultiplier[questionDifficulty] + streakBonus;
```

### 🏆 等級系統

#### 等級計算公式
> **檔案位置**: `src/Analyt.vue` - `userLevel` computed (約第1287行)

```javascript
// 基礎等級計算 (當前實現)
const userLevel = Math.floor(experience / 500) + 1; // 每500經驗值升一級

// 建議改進的等級計算 (指數成長)
function calculateImprovedLevel(experience) {
    // 指數成長公式: XP = 100 * level^1.5
    // 反推等級: level = (XP / 100)^(2/3)
    const level = Math.floor(Math.pow(experience / 100, 2/3)) + 1;
    return Math.max(1, level);
}
```

#### 等級對照表

| 等級 | 所需總經驗值 | 本級所需XP | 稱號 | 特殊權限 |
|------|-------------|------------|------|----------|
| 1 | 0 | 0 | 初心者 | 基礎功能 |
| 2 | 500 | 500 | 新手特務 | 解鎖統計面板 |
| 3 | 1000 | 500 | 見習偵探 | 解鎖靈魂覺醒 |
| 4 | 1500 | 500 | 資深調查員 | 解鎖轉換預測 |
| 5 | 2000 | 500 | 專業分析師 | 解鎖高級分析 |
| 6 | 2500 | 500 | 防詐專家 | 解鎖專家模式 |
| 7 | 3000 | 500 | 首席顧問 | 解鎖導師功能 |
| 8 | 3500 | 500 | 大師級特務 | 全功能權限 |

#### 稱號系統實現
```javascript
// 根據等級和成就獲得稱號
function getUserTitle(level, achievements, stats) {
    const baseTitles = {
        1: '初心者',
        2: '新手特務', 
        3: '見習偵探',
        4: '資深調查員',
        5: '專業分析師',
        6: '防詐專家',
        7: '首席顧問',
        8: '大師級特務'
    };
    
    // 特殊成就稱號
    const specialTitles = {
        perfectScore: '完美主義者',
        speedDemon: '閃電俠',
        persistence: '堅持不懈者',
        mentor: '防詐導師',
        expert: '領域專家'
    };
    
    // 檢查特殊成就
    if (achievements.includes('perfectScore')) return specialTitles.perfectScore;
    if (achievements.includes('speedDemon')) return specialTitles.speedDemon;
    
    return baseTitles[level] || '神秘特務';
}
```

---

## 🌟 靈魂覺醒機制

### 🔓 覺醒條件
> **檔案位置**: `src/Analyt.vue` - `isSoulAwakened` computed (約第2485行)  
> **最後更新**: 2025-10-27 - v3.0 簡化覺醒條件

#### ⚡ 當前實現的覺醒條件 (v3.0)
```javascript
const isSoulAwakened = computed(() => {
    try {
        // 檢查是否完成了 Quiz 測驗
        const hasQuizResult = soulAnimalStore.getUserRecords ? 
            soulAnimalStore.getUserRecords(props.currentUser).length > 0 : false;
        
        if (!hasQuizResult) {
            return false; // 沒有完成 Quiz 就不可能覺醒
        }

        const gameRecords = soulAnimalStore.getUserGameRecords ? 
            soulAnimalStore.getUserGameRecords(props.currentUser) : 
            soulAnimalStore.getUserGameErrors(props.currentUser)
        
        const totalGames = gameRecords ? gameRecords.length : 0;
        
        // 簡化條件：只需要5次遊戲，移除 XP 限制
        return totalGames >= 5;
    } catch (error) {
        return false;
    }
});
```

#### 🎯 覺醒條件說明
- **必要條件**: 完成心理測驗（Quiz.vue）
- **覺醒門檻**: 完成 **5次遊戲**（移除 1000 XP 限制）
- **獎勵機制**: 心理測驗完成可獲得 100 XP 獎勵（顯示在 Animal.vue）

#### ❌ 已移除的條件 (v3.0)
```javascript
// 舊版本 v2.0 的條件（已廢棄）
// return totalGames >= 5 && realXP >= 1000;
```

#### 建議的進階覺醒條件（未來擴展）
```javascript
function calculateAdvancedAwakening(userStats) {
    const conditions = {
        // 基礎條件
        minGames: userStats.totalGames >= 5,
        minXP: userStats.totalExperience >= 1000,
        
        // 進階條件
        averageAccuracy: userStats.averageAccuracy >= 70,
        completedQuiz: userStats.quizCompleted >= 1,
        
        // 特殊條件
        consistentPlay: checkConsistentActivity(userStats.gameHistory),
        diverseExperience: checkGameTypeDiversity(userStats.gameTypes)
    };
    
    // 至少滿足70%的條件
    const satisfiedConditions = Object.values(conditions).filter(Boolean).length;
    const totalConditions = Object.keys(conditions).length;
    
    return (satisfiedConditions / totalConditions) >= 0.7;
}
```

### 🎭 覺醒後解鎖功能

| 功能 | 描述 | 實現位置 |
|------|------|----------|
| 五維度詳細分析 | 顯示詳細的能力雷達圖 | `soulDimensions` computed |
| 轉換可能性預測 | 預測可能轉換的動物類型 | `transformPredictions` computed |
| 個人化建議 | 基於表現的改進建議 | `transformSuggestions` computed |
| 轉換歷史記錄 | 記錄動物類型變化 | `transformHistory` computed |
| 高級統計面板 | 詳細的遊戲表現分析 | 多個 computed 函數 |

---

## 🔮 動物轉換預測算法

### 🧬 KTDI 16動物映射系統
> **檔案位置**: `src/Analyt.vue` - `transformPredictions` computed (約第2824行)

#### 動物類型四軸分類
```javascript
// K軸: Skeptical (懷疑) vs Trusting (信任)
// D/I軸: Deliberate (審慎) vs Immediate (即時)  
// S/G軸: Specific (細節) vs Global (直覺)
// L/R軸: Loss-focused (損失規避) vs Reward-focused (獎勵追求)

const animalTypeMapping = {
    // 深潛分析局 (K-D: 懷疑且審慎)
    'KDSL': '🦊 狐狸型',    // 懷疑+審慎+細節+損失規避
    'KDSR': '🦅 老鷹型',    // 懷疑+審慎+細節+獎勵追求
    'KDGL': '🦉 貓頭鷹型',  // 懷疑+審慎+直覺+損失規避  
    'KDGR': '🦈 鯊魚型',    // 懷疑+審慎+直覺+獎勵追求
    
    // 影襲特攻隊 (K-I: 懷疑但即時)
    'KISL': '🐿️ 松鼠型',   // 懷疑+即時+細節+損失規避
    'KISR': '🐙 章魚型',    // 懷疑+即時+細節+獎勵追求
    'KIGL': '🐱 貓咪型',    // 懷疑+即時+直覺+損失規避
    'KIGR': '🐺 狼型',      // 懷疑+即時+直覺+獎勵追求
    
    // 重裝守備隊 (T-D: 信任且審慎)  
    'TDSL': '🐢 烏龜型',    // 信任+審慎+細節+損失規避
    'TDSR': '🐘 大象型',    // 信任+審慎+細節+獎勵追求
    'TDGL': '🦛 河馬型',    // 信任+審慎+直覺+損失規避
    'TDGR': '🦍 金剛型',    // 信任+審慎+直覺+獎勵追求
    
    // 閃電先鋒 (T-I: 信任且即時)
    'TISL': '🐭 老鼠型',    // 信任+即時+細節+損失規避  
    'TISR': '🦦 水獺型',    // 信任+即時+細節+獎勵追求
    'TIGL': '🦌 麋鹿型',    // 信任+即時+直覺+損失規避
    'TIGR': '🐶 柴犬型'     // 信任+即時+直覺+獎勵追求
};
```

#### 轉換預測算法
```javascript
function predictAnimalTransformation(currentScores, gameHistory) {
    const predictions = [];
    
    // 計算每個動物類型的匹配度
    for (const [typeCode, animalName] of Object.entries(animalTypeMapping)) {
        const axisScores = parseTypeCode(typeCode);
        const matchScore = calculateMatchScore(currentScores, axisScores);
        const trendScore = calculateTrendScore(gameHistory, axisScores);
        
        // 綜合匹配度計算
        const totalScore = (matchScore * 0.7 + trendScore * 0.3);
        
        predictions.push({
            animal: animalName,
            code: typeCode,
            probability: Math.round(totalScore),
            reasoning: generateReasoning(axisScores, currentScores)
        });
    }
    
    // 排序並返回前5名
    return predictions
        .sort((a, b) => b.probability - a.probability)
        .slice(0, 5);
}

function calculateMatchScore(userScores, targetScores) {
    const weights = { K: 0.3, DI: 0.25, SG: 0.25, LR: 0.2 };
    let totalScore = 0;
    
    // K軸匹配度 (權威態度)
    const kDiff = Math.abs(userScores.authority - targetScores.K);
    const kScore = Math.max(0, 100 - kDiff * 2);
    totalScore += kScore * weights.K;
    
    // D/I軸匹配度 (時間偏好)  
    const diDiff = Math.abs(userScores.timing - targetScores.DI);
    const diScore = Math.max(0, 100 - diDiff * 2);
    totalScore += diScore * weights.DI;
    
    // S/G軸匹配度 (處理風格)
    const sgDiff = Math.abs(userScores.style - targetScores.SG);
    const sgScore = Math.max(0, 100 - sgDiff * 2);
    totalScore += sgScore * weights.SG;
    
    // L/R軸匹配度 (動機偏好)
    const lrDiff = Math.abs(userScores.motivation - targetScores.LR);
    const lrScore = Math.max(0, 100 - lrDiff * 2);
    totalScore += lrScore * weights.LR;
    
    return totalScore;
}
```

### 📊 階段性轉換觸發條件

#### 🌙 階段1: 前5次遊戲（未覺醒期）
- **狀態**: 無靈魂動物設定
- **分數**: 無五維度分數顯示
- **規則**: 必須完成心理測驗 + 遊戲5次後才能覺醒

#### 🌟 階段2: 第5次遊戲（首次覺醒）
- **狀態**: 設定心理測驗結果為初始靈魂動物
- **分數**: 使用官方區間中間值作為基準
- **規則**: 無條件設定為心理測驗測出的動物類型
- **記錄**: 添加覺醒事件到轉換歷史

#### 🎯 階段3: 第6次遊戲（覺醒調整期）
- **狀態**: 維持心理測驗動物，但分數微調
- **分數計算**: 基準分數 + 前5次遊戲平均影響（限制±5範圍）
- **調整規則**: 
  ```javascript
  // 計算前5次遊戲的平均表現
  const avgPerformance = first5Games.reduce((sum, game) => {
    return sum + (10 - (game.wrongIds?.length || 0)) / 10;
  }, 0) / 5;
  
  // 每個維度的調整值
  const dimensionAdjustment = (avgPerformance - 0.5) * 10; // ±5範圍
  
  // 確保調整後仍在該動物的官方區間內
  const adjustedScore = Math.max(minRange, Math.min(maxRange, baseScore + dimensionAdjustment));
  ```
- **限制**: 調整後的分數必須保持在心理測驗動物的官方區間範圍內

#### 🚀 階段4: 第7次遊戲後（自由演化期）
- **狀態**: 允許靈魂動物轉換
- **轉換條件**: 純基於五維度分數區間匹配，無匹配率要求
- **轉換邏輯**:
  ```javascript
  function checkTransformationTrigger(currentScores, animalRanges) {
    let bestMatch = null;
    let bestDistance = Infinity;
    let perfectMatches = [];
    
    // 遍歷所有16種動物的區間
    Object.entries(animalRanges).forEach(([animal, ranges]) => {
      let totalDistance = 0;
      let perfectDimensions = 0;
      
      // 計算與每個維度區間的距離
      ['authority', 'timing', 'style', 'motivation', 'tech'].forEach(dim => {
        const score = currentScores[dim];
        const [min, max] = ranges[dim];
        
        if (score < min) {
          totalDistance += (min - score);
        } else if (score > max) {
          totalDistance += (score - max);
        } else {
          perfectDimensions++; // 在區間內
        }
      });
      
      // 如果所有5個維度都完美匹配
      if (perfectDimensions === 5) {
        perfectMatches.push(animal);
      }
      
      // 記錄最小距離的動物
      if (totalDistance < bestDistance) {
        bestDistance = totalDistance;
        bestMatch = animal;
      }
    });
    
    // 優先選擇完美匹配，否則選擇最小距離
    return perfectMatches.length > 0 ? perfectMatches[0] : bestMatch;
  }
  ```

#### 🔄 轉換觸發時機
1. **立即轉換**: 第7次遊戲後，每次遊戲結束都會檢查
2. **轉換條件**: 計算出的最適動物 ≠ 當前記錄的動物
3. **無延遲**: 不需要連續多次匹配，只要區間匹配就立即轉換
4. **無回退限制**: 允許在不同動物間自由轉換

### 🎯 五維度分數演化規則

#### 📊 分數計算基礎
- **基準分數**: 使用心理測驗動物的官方區間中間值
- **累積數據源**: 直接使用靈魂系統中真實累積的心理分數
- **分數範圍**: 所有分數限制在 0-100 範圍內
- **區間對應**: 每種動物都有固定的五維度區間範圍

#### 🎮 累積分數到五維度的映射
```javascript
// 靈魂系統中的心理分數直接映射到五維度
const psychologyToFiveDimensions = {
  authority: 'authority',    // 權威偏好 → 權威偏好
  timing: 'timing',          // 時間習慣 → 時間習慣  
  style: 'style',            // 溝通風格 → 溝通風格
  motivation: 'motivation',  // 獎懲誘惑 → 獎懲誘惑
  tech: 'techLevel'          // 科技適應 → 科技等級
};

// 獲取靈魂系統中累積的真實分數
const currentPsychologyScores = soulSystem.psychologyScores?.value || { 
  authority: 0, timing: 0, style: 0, motivation: 0 
};
const techLevel = soulSystem.techLevel?.value || 1;
```

#### 🔢 具體演化階段

**階段1: 前5次遊戲（基準期）**
```javascript
// 直接返回心理測驗的區間中間值，無任何變化
return initialScores[psychologyTestAnimal];
```

**階段2: 第6次遊戲（調整期）**
```javascript
// 使用靈魂系統中累積的心理分數進行調整
const currentPsychologyScores = soulSystem.psychologyScores?.value;

Object.keys(baseScores).forEach(dim => {
  const baseScore = baseScores[dim];
  let adjustment = 0;
  
  if (dim === 'tech') {
    // 科技維度使用科技等級
    const techLevel = soulSystem.techLevel?.value || 1;
    adjustment = (techLevel - 1) * 2; // 每級+2分
  } else {
    // 心理維度使用累積的心理分數，縮放到±5範圍
    const cumulativeScore = currentPsychologyScores[dim] || 0;
    adjustment = Math.max(-5, Math.min(5, cumulativeScore / 5)); // 除以5來縮放
  }
  
  // 確保不超出該動物的官方區間
  const [min, max] = animalRanges[baseAnimal][dim];
  adjustedScore[dim] = Math.max(min, Math.min(max, baseScore + adjustment));
});
```

**階段4: 第7次後（自由演化期）**
```javascript
// 基於累積的心理分數進行自由演化
const currentPsychologyScores = soulSystem.psychologyScores?.value;

Object.keys(evolvedScores).forEach(dim => {
  const baseScore = baseScores[dim];
  let totalEvolution = 0;
  
  if (dim === 'tech') {
    // 科技維度基於科技等級
    totalEvolution = (techLevel - 1) * 3; // 每級+3分，影響較大
  } else {
    // 心理維度基於累積的心理分數
    const cumulativeScore = currentPsychologyScores[dim] || 0;
    totalEvolution = cumulativeScore / 3; // 縮放係數，讓影響適中
  }
  
  // 應用演化（只有0-100的絕對限制）
  evolvedScores[dim] = Math.max(0, Math.min(100, baseScore + totalEvolution));
});
```

#### ⚠️ 重要設計考量
1. **數據一致性**: Analyt.vue 直接使用靈魂系統中累積的真實心理分數，確保顯示與遊戲過程一致
2. **累積總分顯示**: 累積總分直接顯示 soulSystem.psychologyScores.value 中的各維度分數
3. **階段2限制**: 確保第5-6次遊戲期間不會偏離心理測驗動物的特性
4. **個人化特色**: 基於真實遊戲累積的心理分數，每個用戶都有獨特的演化軌跡
5. **演化邊界**: 第7次後的自由演化仍需保持在合理範圍（0-100）內
6. **轉換合理性**: 數值變化應該能對應到16種動物的官方區間範圍

#### 🔧 修正重點
- **修正前**: 使用遊戲記錄重新計算心理分數影響
- **修正後**: 直接使用靈魂系統中真實累積的心理分數
- **問題解決**: 累積總分不再顯示為0，而是顯示真實的累積結果

---

## 🧠 心理軸線分析

### 📐 16種動物轉換分數列表
> **檔案位置**: `16種動物轉換分數列表.md` 和 `src/Analyt.vue` - `getPsychologyAnalysis` (約第1940行)

#### 官方分數範圍對照

| 動物類型 | 權威偏好 | 時間習慣 | 溝通風格 | 獎懲誘惑 | 科技適應 |
|----------|----------|----------|----------|----------|----------|
| 🦊 狐狸型 | 20-40 | 20-40 | 60-80 | 70-90 | 50-70 |
| 🦅 老鷹型 | 15-35 | 15-35 | 65-85 | 20-40 | 60-80 |
| 🦉 貓頭鷹型 | 20-40 | 20-40 | 25-45 | 70-90 | 80-100 |
| 🦈 鯊魚型 | 15-35 | 15-35 | 20-40 | 20-40 | 85-100 |
| 🐿️ 松鼠型 | 20-40 | 60-80 | 60-80 | 70-90 | 40-60 |
| 🐙 章魚型 | 15-35 | 65-85 | 65-85 | 20-40 | 70-90 |
| 🐱 貓咪型 | 20-40 | 60-80 | 25-45 | 70-90 | 60-80 |
| 🐺 狼型 | 15-35 | 65-85 | 20-40 | 20-40 | 80-100 |
| 🐢 烏龜型 | 60-80 | 20-40 | 60-80 | 70-90 | 20-40 |
| 🐘 大象型 | 65-85 | 15-35 | 65-85 | 20-40 | 30-50 |
| 🦛 河馬型 | 60-80 | 20-40 | 25-45 | 70-90 | 20-40 |
| 🦍 金剛型 | 65-85 | 15-35 | 20-40 | 20-40 | 40-60 |
| 🐭 老鼠型 | 60-80 | 60-80 | 60-80 | 70-90 | 30-50 |
| 🦦 水獺型 | 65-85 | 65-85 | 65-85 | 20-40 | 50-70 |
| 🦌 麋鹿型 | 60-80 | 60-80 | 25-45 | 70-90 | 40-60 |
| 🐶 柴犬型 | 65-85 | 65-85 | 20-40 | 20-40 | 60-80 |

#### 動態分數計算邏輯
```javascript
function calculatePsychologyScores(gameHistory, userStats) {
    // 權威偏好計算 (0=極度懷疑, 100=完全信任)
    const authorityScore = calculateAuthorityTrust(gameHistory);
    
    // 時間習慣計算 (0=極度審慎, 100=完全即時)
    const timingScore = calculateTimingPreference(gameHistory);
    
    // 溝通風格計算 (0=純粹直覺, 100=完全細節)
    const styleScore = calculateCommunicationStyle(gameHistory);
    
    // 獎懲誘惑計算 (0=純粹獎勵追求, 100=完全損失規避)
    const motivationScore = calculateMotivationBias(gameHistory);
    
    // 科技適應計算 (0=完全傳統, 100=完全科技)
    const techScore = calculateTechAdaptation(gameHistory);
    
    return {
        authority: Math.round(authorityScore),
        timing: Math.round(timingScore), 
        style: Math.round(styleScore),
        motivation: Math.round(motivationScore),
        tech: Math.round(techScore)
    };
}

function calculateAuthorityTrust(gameHistory) {
    let trustScore = 50; // 基礎中性值
    
    gameHistory.forEach(game => {
        game.questions.forEach(question => {
            // 分析用戶對權威來源的反應
            if (question.type === 'authority_source') {
                if (question.userAnswer === question.correctAnswer) {
                    // 正確識別權威 -> 增加信任分數
                    trustScore += question.isLegitimate ? 2 : -2;
                } else {
                    // 錯誤判斷 -> 相反調整
                    trustScore += question.isLegitimate ? -3 : 3;
                }
            }
        });
    });
    
    return Math.max(0, Math.min(100, trustScore));
}

function calculateTimingPreference(gameHistory) {
    const responseTimes = [];
    let hastyDecisions = 0;
    let deliberateDecisions = 0;
    
    gameHistory.forEach(game => {
        game.questions.forEach(question => {
            responseTimes.push(question.responseTime);
            
            // 分析決策模式
            if (question.responseTime < 5) {
                hastyDecisions++;
                if (question.isCorrect) {
                    // 快速且正確 -> 即時偏好
                    hastyDecisions += 0.5;
                }
            } else if (question.responseTime > 15) {
                deliberateDecisions++;
                if (question.isCorrect) {
                    // 慢速但正確 -> 審慎偏好  
                    deliberateDecisions += 0.5;
                }
            }
        });
    });
    
    const avgResponseTime = responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length;
    const timingRatio = hastyDecisions / (hastyDecisions + deliberateDecisions);
    
    // 綜合計算 (快=即時=高分, 慢=審慎=低分)
    return (timingRatio * 60) + ((30 - Math.min(avgResponseTime, 30)) / 30 * 40);
}
```

---

## 📁 檔案位置索引

### 主要計算邏輯檔案

| 功能模組 | 檔案路徑 | 關鍵函數/變數 | 行數範圍 |
|----------|----------|---------------|----------|
| 五維度評估 | `src/Analyt.vue` | `soulDimensions` computed | ~2519-2594 |
| 經驗值系統 | `src/Analyt.vue` | `userStats` computed | ~1242-1286 |
| 覺醒機制 | `src/Analyt.vue` | `isSoulAwakened` computed | ~2485-2513 |
| 轉換預測 | `src/Analyt.vue` | `transformPredictions` computed | ~2824-2891 |
| 心理分析 | `src/Analyt.vue` | `getPsychologyAnalysis` | ~1940-2072 |
| 動物詳情 | `src/Analyt.vue` | `getAnimalDetails` | ~2138-2307 |
| 等級計算 | `src/Analyt.vue` | `userLevel` computed | ~1287-1289 |
| 靈魂XP存儲 | `src/stores/soulAnimalSystem.js` | `soulXP` | 整個檔案 |
| 官方分數 | `16種動物轉換分數列表.md` | 分數範圍表格 | 全檔案 |

### 配置和資料檔案

| 資料類型 | 檔案路徑 | 內容描述 |
|----------|----------|----------|
| 動物元資料 | `src/Analyt.vue` | `ANIMAL_META` 常數 (~1540-1739) |
| SVG圖庫 | `src/Analyt.vue` | `SVG_BANK` 常數 (~1505-1536) |
| 詐騙類型映射 | `src/Analyt.vue` | `fraudLabelMap` (~1480-1490) |
| 轉換分數標準 | `16種動物轉換分數列表.md` | 官方KTDI分數範圍 |

---

## ⚠️ 潛在問題分析

### 🔍 演算法邏輯問題

#### 1. 經驗值系統問題
```
❌ 當前問題:
- 線性成長 (每500XP升級) 缺乏挑戰性
- 沒有經驗值衰減機制
- 缺乏防作弊措施

✅ 建議改進:
- 改用指數成長曲線
- 加入活躍度衰減
- 實施反作弊檢測
```

#### 2. 五維度計算問題
```
❌ 當前問題:  
- 計算邏輯過於簡化
- 缺乏歷史趨勢分析
- 沒有考慮個體差異

✅ 建議改進:
- 加入時間權重衰減
- 實施滑動視窗平均
- 建立個人基線模型
```

#### 3. 轉換預測問題
```
❌ 當前問題:
- 預測算法不夠精確
- 缺乏機器學習成分
- 轉換觸發過於敏感

✅ 建議改進:  
- 實施貝葉斯更新
- 加入信心區間
- 增加轉換阻尼機制
```

### 📊 數值平衡問題

#### 分數分布分析
```javascript
// 當前分數分布可能存在的問題
const distributionIssues = {
    // 分數集中在中等範圍
    centralTendency: "大部分用戶分數集中在50-70分",
    
    // 極值難以達到
    extremeValues: "很少用戶能達到90+或低於30分",
    
    // 動物類型分布不均
    animalDistribution: "某些動物類型出現頻率過高",
    
    // 轉換過於頻繁
    frequentChanges: "用戶動物類型變化過於頻繁"
};
```

#### 建議的調整方案
```javascript
// 改進的分數正規化
function improvedScoreNormalization(rawScore, populationStats) {
    const mean = populationStats.mean;
    const stdDev = populationStats.standardDeviation;
    
    // Z-score標準化
    const zScore = (rawScore - mean) / stdDev;
    
    // 轉換為0-100分數，保持正態分布特性
    const normalizedScore = 50 + (zScore * 15);
    
    // 確保範圍在0-100之間
    return Math.max(0, Math.min(100, normalizedScore));
}
```

### 🛠️ 技術實現問題

#### 1. 性能問題
- 複雜計算可能影響頁面響應速度
- 大量歷史資料處理缺乏優化
- 沒有快取機制

#### 2. 資料一致性問題  
- 不同組件間的計算可能不一致
- 缺乏統一的資料驗證機制
- 歷史資料遷移可能出錯

#### 3. 擴展性問題
- 硬編碼的計算邏輯難以調整
- 新增動物類型需要大量修改
- 缺乏A/B測試框架

---

## 📈 改進建議

### 短期改進 (1-2週)
1. **修復分數計算bug**: 確保所有計算邏輯一致
2. **優化性能**: 加入計算結果快取
3. **改進UI展示**: 讓分數變化更直觀

### 中期改進 (1-2個月)  
1. **重構經驗值系統**: 實施指數成長和衰減機制
2. **增強轉換預測**: 加入機器學習演算法
3. **建立測試框架**: 支援A/B測試和資料驗證

### 長期改進 (3-6個月)
1. **個人化模型**: 基於用戶行為建立個人化評估
2. **群體分析**: 加入同儕比較和群體統計
3. **預測性分析**: 預測用戶未來表現趨勢

---

## 📚 參考資料

- KTDI心理學理論基礎
- 遊戲化系統設計原則  
- 機器學習在用戶行為分析中的應用
- 防詐騙教育的心理學研究

---

*最後更新: 2025年10月27日*
*文檔版本: v1.0*
*維護者: AI助手*